import re
import pdfplumber
import requests
import pandas as pd
#
from pdfminer.pdfinterp import PDFResourceManager, PDFPageInterpreter
from pdfminer.pdfpage import PDFPage
from pdfminer.converter import TextConverter
from pdfminer.layout import LAParams
import io
import re

def pdf_to_text(path):
    manager = PDFResourceManager()
    retstr = io.StringIO()
    layout = LAParams(all_texts=True)
    device = TextConverter(manager, retstr, laparams=layout)
    filepath = open(path, 'rb')
    interpreter = PDFPageInterpreter(manager, device)
    for page in PDFPage.get_pages(filepath, check_extractable=False):
        interpreter.process_page(page)
    text = retstr.getvalue()
    filepath.close()
    device.close()
    retstr.close()
    return text
#
pdf_file = "C:/Users/berat/Desktop/ak_yatırım.pdf"

sirket_haberleri_pattern = '(?<=Şirket Haberleri).*?(?=Göstergeler)'
text_list = []
sirket_haber_list_1 =[]
text_list.append(pdf_to_text(pdf_file))

if 'Şirket Haberleri' in text_list:
    sirket_haberleri_pattern = '(?<=Şirket Haberleri).*?(?=Göstergeler)'

for text in text_list:
    sirket_haber_list_1.append(re.findall(sirket_haberleri_pattern, text, re.DOTALL))
#

text = sirket_haber_list_1[0][0]
text1 = text.split('En Yüksek Getiri')[0]
text2 = text.split('Şirket Haberleri Devamı')[1:]
text2 = "".join(text2)
#
text = text1 + text2
text = text.split('BUGÜN 2Ç20 MALİ SONUÇLARINI AÇIKLAMASI BEKLENEN ŞİRKETLER')[0]
#
text_splitted = text.split("\n")
#
news_list1 = []
text_splitted = [i for i in text_splitted if i] 
for row in text_splitted:
    if '●' in row:
        news_list1.append(row.split('\uf0a7')[-1][1:].strip())
    else:
        news_list1[-1] = news_list1[-1] + row
#
news_list = []
for i in news_list1:
    if 'sektör' not in i.lower()[0:55]:
        news_list.append(i)
#output
news_list
